"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}window.CustomEvent||function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}();var DESKTOP_EVENTS=["VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppAddToCommunity","VKWebAppGetGeodata","VKWebAppGetUserInfo","VKWebAppGetPhoneNumber","VKWebAppGetClientVersion","VKWebAppGetCommunityAuthToken","VKWebAppOpenPayForm","VKWebAppShare","VKWebAppAllowNotifications","VKWebAppDenyNotifications","VKWebAppShowWallPostBox","VKWebAppGetEmail","VKWebAppAllowMessagesFromGroup","VKWebAppJoinGroup","VKWebAppOpenApp","VKWebAppSetViewSettings","VKWebAppSetLocation","VKWebAppScroll","VKWebAppResizeWindow"],FUNCTION="function",UNDEFINED="undefined",isClient=typeof window!==UNDEFINED,isChrome=navigator&&~navigator.userAgent.indexOf("CriOS"),androidBridge=isClient&&window.AndroidBridge,iosBridge=!isChrome&&(isClient&&window.webkit&&window.webkit.messageHandlers),isWeb=!androidBridge&&!iosBridge,eventType=isWeb?"message":"VKWebAppEvent",promises={},methodCounter=0,frameId="",subscribers=[];window.addEventListener(eventType,function(e){var t=null,i={};if(isWeb){if(e.data.type&&"VKWebAppSettings"===e.data.type)return void(frameId=e.data.frameId);e.data.hasOwnProperty("frameId")&&delete e.data.frameId,e.data.hasOwnProperty("connectVersion")&&delete e.data.connectVersion}if(subscribers.length>0&&subscribeHandler(e),isWeb?e.data&&e.data.data&&(i=_extends({},e.data),t=promises[i.data.request_id]):e.detail&&e.detail.data&&(i=_extends({},e.detail),t=promises[i.data.request_id]),i.data&&i.data.request_id&&(t=promises[i.data.request_id]))return t.customRequestId&&delete i.data.request_id,i.data.error_type?t.reject(i):t.resolve(i)});var subscribeHandler=function(e){var t=subscribers.slice(),i={};isWeb?i.detail=_extends({},e.data):e.detail&&e.detail.data&&(i.detail=_extends({},e.detail)),t.forEach(function(e){e(i)})},index={send:function(e,t){t||(t={});var i=t.request_id?t.request_id:"method#"+methodCounter++,r=!1;if(t.hasOwnProperty("request_id")||(r=!0,t.request_id=i),androidBridge&&typeof androidBridge[e]===FUNCTION&&androidBridge[e](JSON.stringify(t)),iosBridge&&iosBridge[e]&&typeof iosBridge[e].postMessage===FUNCTION&&iosBridge[e].postMessage(t),isWeb&&parent.postMessage({handler:e,params:t,frameId:frameId,type:"vk-connect"},"*"),"VKWebAppInit"!==e)return new Promise(function(e,n){promises[i]={resolve:e,reject:n,params:t,customRequestId:r}})},supports:function(e){return!(!androidBridge||typeof androidBridge[e]!==FUNCTION)||!(!iosBridge||!iosBridge[e]||typeof iosBridge[e].postMessage!==FUNCTION)||!!~DESKTOP_EVENTS.indexOf(e)},subscribe:function(e){subscribers.push(e)}};module.exports=index;
